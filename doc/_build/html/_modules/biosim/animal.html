
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>biosim.animal &#8212; BioSim_G25_Granheim_Svebestad 21.01.2020 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for biosim.animal</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This code will contain the island class</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Markus Ola Granheim &amp; Rasmus Svebestad&quot;</span>
<span class="n">__email__</span> <span class="o">=</span> <span class="s2">&quot;mgranhei@nmbu.no &amp; rasmus.svebestad@nmbu.no&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">math</span>


<div class="viewcode-block" id="Animal"><a class="viewcode-back" href="../../animal.html#biosim.animal.Animal">[docs]</a><span class="k">class</span> <span class="nc">Animal</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for animal functions</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Animal.calculate_fitness"><a class="viewcode-back" href="../../animal.html#biosim.animal.Animal.calculate_fitness">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_fitness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">animals</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the fitness for all the animals on one tile.</span>

<span class="sd">        :param pos: Gives the position were we want to calculate the fitness</span>
<span class="sd">        :param animals: The animal dictionary for the given species</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">animals</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">animal</span> <span class="ow">in</span> <span class="n">animals</span><span class="p">[</span><span class="n">pos</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">animal</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">new_fitness</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fitness&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
                    <span class="n">animal</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new_fitness</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_fitness</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fitness&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi_age</span> <span class="o">*</span> <span class="p">(</span><span class="n">animal</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_half</span><span class="p">))))</span> <span class="o">*</span>
                                              <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi_weight</span> <span class="o">*</span> <span class="p">(</span><span class="n">animal</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span>
                                                                                      <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_half</span><span class="p">)))))}</span>
                    <span class="n">animal</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new_fitness</span><span class="p">)</span></div>

<div class="viewcode-block" id="Animal.sort_by_fitness"><a class="viewcode-back" href="../../animal.html#biosim.animal.Animal.sort_by_fitness">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">sort_by_fitness</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">animals</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sorts the animals after their fitness, best to worst.</span>

<span class="sd">        :param pos: the position(tile)</span>
<span class="sd">        :param animals: the animal dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">animals</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">animals</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">animals</span><span class="p">[</span><span class="n">pos</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;fitness&#39;</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="Animal.breeding"><a class="viewcode-back" href="../../animal.html#biosim.animal.Animal.breeding">[docs]</a>    <span class="k">def</span> <span class="nf">breeding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">island_class</span><span class="p">,</span> <span class="n">animals</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Breeds animals on the given position for the given species.</span>

<span class="sd">        :param pos: The position/tile</span>
<span class="sd">        :param island_class: The island-class, used to add animals</span>
<span class="sd">        :param animals: the dictionary contain info about all the selected species</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">animals</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">animals</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">animal</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">animals</span><span class="p">[</span><span class="n">pos</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">animal</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">zeta</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w_birth</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_birth</span><span class="p">):</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">*</span> <span class="n">animal</span><span class="p">[</span><span class="s1">&#39;fitness&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">():</span>
                    <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w_birth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_birth</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">animal</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi</span> <span class="o">*</span> <span class="n">w</span><span class="p">:</span>
                        <span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="n">pos</span><span class="p">,</span> <span class="s1">&#39;pop&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;species&#39;</span><span class="p">:</span> <span class="n">animal</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">],</span> <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="n">w</span><span class="p">}]})</span>
                        <span class="n">animals</span><span class="p">[</span><span class="n">pos</span><span class="p">][</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi</span> <span class="o">*</span> <span class="n">w</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">children</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">island_class</span><span class="o">.</span><span class="n">add_animals</span><span class="p">(</span><span class="n">children</span><span class="p">)</span></div>

<div class="viewcode-block" id="Animal.aging"><a class="viewcode-back" href="../../animal.html#biosim.animal.Animal.aging">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">aging</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">animals</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ages all the animals on one tile with 1 year.</span>

<span class="sd">        :param pos: The position/tile</span>
<span class="sd">        :param animals: The animal dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">animals</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">animals</span><span class="p">[</span><span class="n">pos</span><span class="p">])):</span>
                <span class="n">animals</span><span class="p">[</span><span class="n">pos</span><span class="p">][</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;age&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="Animal.loss_of_weight"><a class="viewcode-back" href="../../animal.html#biosim.animal.Animal.loss_of_weight">[docs]</a>    <span class="k">def</span> <span class="nf">loss_of_weight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">animals</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reduces the weight of all the animals on a single tile</span>

<span class="sd">        :param pos: The position/tile</span>
<span class="sd">        :param animals: The animal dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">animals</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">animals</span><span class="p">[</span><span class="n">pos</span><span class="p">])):</span>
                <span class="n">animals</span><span class="p">[</span><span class="n">pos</span><span class="p">][</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta</span> <span class="o">*</span> <span class="n">animals</span><span class="p">[</span><span class="n">pos</span><span class="p">][</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="Animal.death"><a class="viewcode-back" href="../../animal.html#biosim.animal.Animal.death">[docs]</a>    <span class="k">def</span> <span class="nf">death</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">animals</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes  from the animals list according to the formula for death</span>
<span class="sd">        :param pos: the position asked for</span>
<span class="sd">        :param animals: animal-dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">animals</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">animal</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">animals</span><span class="p">[</span><span class="n">pos</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">animal</span><span class="p">[</span><span class="s1">&#39;fitness&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">omega</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">animal</span><span class="p">[</span><span class="s1">&#39;fitness&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">p</span> <span class="o">&gt;=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">():</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="k">del</span> <span class="n">animals</span><span class="p">[</span><span class="n">pos</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span></div></div>


<div class="viewcode-block" id="Herbivores"><a class="viewcode-back" href="../../animal.html#biosim.animal.Herbivores">[docs]</a><span class="k">class</span> <span class="nc">Herbivores</span><span class="p">(</span><span class="n">Animal</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The animal subclass for Herbivores</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w_birth</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span> <span class="n">sigma_birth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">eta</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">a_half</span><span class="o">=</span><span class="mf">40.0</span><span class="p">,</span> <span class="n">phi_age</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">w_half</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
                 <span class="n">phi_weight</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">lambda1</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">zeta</span><span class="o">=</span><span class="mf">3.5</span><span class="p">,</span> <span class="n">xi</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">omega</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="mf">10.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The class containing all the necessary functions for herbivores.</span>

<span class="sd">        :param w_birth: The average weight for a newborn Herbivore</span>
<span class="sd">        :param sigma_birth: The standard deviation for weight of a newborn</span>
<span class="sd">        :param beta: The growing factor telling how much of the food is changed into weight</span>
<span class="sd">        :param eta: The weight reduction factor</span>
<span class="sd">        :param a_half: Fitness-factor</span>
<span class="sd">        :param phi_age: Fitness-factor</span>
<span class="sd">        :param w_half: Fitness-factor</span>
<span class="sd">        :param phi_weight: Fitness-factor</span>
<span class="sd">        :param mu: Factor used to calculate probability for migration</span>
<span class="sd">        :param lambda1: Migration-factor</span>
<span class="sd">        :param gamma: Gives the probability for giving birth, given number of animals on same tiles and their fitness</span>
<span class="sd">        :param zeta: Gives the restrictions for giving girth depending on weight</span>
<span class="sd">        :param xi: The factor for weight loss after given birth</span>
<span class="sd">        :param omega: The probability of dieing given the animals fitnessvalue</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w_birth</span> <span class="o">=</span> <span class="n">w_birth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigma_birth</span> <span class="o">=</span> <span class="n">sigma_birth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="n">beta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eta</span> <span class="o">=</span> <span class="n">eta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a_half</span> <span class="o">=</span> <span class="n">a_half</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phi_age</span> <span class="o">=</span> <span class="n">phi_age</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w_half</span> <span class="o">=</span> <span class="n">w_half</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phi_weight</span> <span class="o">=</span> <span class="n">phi_weight</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mu</span> <span class="o">=</span> <span class="n">mu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lambda1</span> <span class="o">=</span> <span class="n">lambda1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zeta</span> <span class="o">=</span> <span class="n">zeta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xi</span> <span class="o">=</span> <span class="n">xi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">omega</span> <span class="o">=</span> <span class="n">omega</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">f</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">animals_with_new_pos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idx_for_animals_to_remove</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="Herbivores.set_new_params"><a class="viewcode-back" href="../../animal.html#biosim.animal.Herbivores.set_new_params">[docs]</a>    <span class="k">def</span> <span class="nf">set_new_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set class parameters.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        new_params : dict</span>
<span class="sd">            Legal keys: &#39;w_birth&#39;, &#39;sigma_birth&#39;, &#39;beta&#39;, &#39;eta&#39;, &#39;a_half&#39;, &#39;phi_age&#39;, &#39;w_half&#39;, &#39;phi_weight&#39;, &#39;mu&#39;,</span>
<span class="sd">                        &#39;lambda&#39;, &#39;gamma&#39;, &#39;zeta&#39;, &#39;xi&#39;, &#39;omega&#39;, &#39;F&#39;</span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError, KeyError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">default_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;w_birth&#39;</span><span class="p">:</span> <span class="mf">8.0</span><span class="p">,</span>
                          <span class="s1">&#39;sigma_birth&#39;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span>
                          <span class="s1">&#39;beta&#39;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span>
                          <span class="s1">&#39;eta&#39;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>
                          <span class="s1">&#39;a_half&#39;</span><span class="p">:</span> <span class="mf">40.0</span><span class="p">,</span>
                          <span class="s1">&#39;phi_age&#39;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
                          <span class="s1">&#39;w_half&#39;</span><span class="p">:</span> <span class="mf">10.0</span><span class="p">,</span>
                          <span class="s1">&#39;phi_weight&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
                          <span class="s1">&#39;mu&#39;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span>
                          <span class="s1">&#39;lambda&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
                          <span class="s1">&#39;gamma&#39;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
                          <span class="s1">&#39;zeta&#39;</span><span class="p">:</span> <span class="mf">3.5</span><span class="p">,</span>
                          <span class="s1">&#39;xi&#39;</span><span class="p">:</span> <span class="mf">1.2</span><span class="p">,</span>
                          <span class="s1">&#39;omega&#39;</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">,</span>
                          <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="mf">10.0</span><span class="p">}</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">new_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">default_params</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;Invalid parameter name: &#39;</span> <span class="o">+</span> <span class="n">key</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;w_birth&#39;</span> <span class="ow">in</span> <span class="n">new_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;w_birth&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;birth_weight must be larger or equal to 0&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">w_birth</span> <span class="o">=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;w_birth&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;sigma_birth&#39;</span> <span class="ow">in</span> <span class="n">new_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;sigma_birth&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;sigma_birth must be larger or equal to 0&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigma_birth</span> <span class="o">=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;sigma_birth&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;beta&#39;</span> <span class="ow">in</span> <span class="n">new_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;p_death must be larger or equal to 0.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;eta&#39;</span> <span class="ow">in</span> <span class="n">new_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;eta&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;p_divide must be in [0, 1].&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eta</span> <span class="o">=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;eta&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;a_half&#39;</span> <span class="ow">in</span> <span class="n">new_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;a_half&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;a_half must be larger or equal to 0.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a_half</span> <span class="o">=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;a_half&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;phi_age&#39;</span> <span class="ow">in</span> <span class="n">new_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;phi_age&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;phi_age must be larger or equal to 0.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phi_age</span> <span class="o">=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;phi_age&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;w_half&#39;</span> <span class="ow">in</span> <span class="n">new_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;w_half&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;w_half must be larger or equal to 0&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">w_half</span> <span class="o">=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;w_half&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;phi_weight&#39;</span> <span class="ow">in</span> <span class="n">new_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;phi_weight&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;phi_weight must be larger or equal to 0.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phi_weight</span> <span class="o">=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;phi_weight&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;mu&#39;</span> <span class="ow">in</span> <span class="n">new_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;mu&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;mu must be larger or equal to 0.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mu</span> <span class="o">=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;mu&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;lambda&#39;</span> <span class="ow">in</span> <span class="n">new_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;lambda&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;lambda must be larger or equal to 0.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lambda1</span> <span class="o">=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;lambda&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;gamma&#39;</span> <span class="ow">in</span> <span class="n">new_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;gamma&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;gamma must be larger or equal to 0.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;gamma&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;zeta&#39;</span> <span class="ow">in</span> <span class="n">new_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;zeta&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;zetta must be larger or equal to 0&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zeta</span> <span class="o">=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;zeta&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;xi&#39;</span> <span class="ow">in</span> <span class="n">new_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;xi&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;xi must be larger or equal to 0&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xi</span> <span class="o">=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;xi&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;omega&#39;</span> <span class="ow">in</span> <span class="n">new_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;omega&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;omega must be larger or equal to 0.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">omega</span> <span class="o">=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;omega&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;F&#39;</span> <span class="ow">in</span> <span class="n">new_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;F must be larger or equal to 0&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="Herbivores.sort_before_getting_hunted"><a class="viewcode-back" href="../../animal.html#biosim.animal.Herbivores.sort_before_getting_hunted">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">sort_before_getting_hunted</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">animals</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sorts the herbivores from worst to best fitness.</span>

<span class="sd">        :param pos: The position to sort the animals</span>
<span class="sd">        :param animals: The animal dictionary that shall be sorted</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">animals</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">animals</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">animals</span><span class="p">[</span><span class="n">pos</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;fitness&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="Herbivores.migration_calculations"><a class="viewcode-back" href="../../animal.html#biosim.animal.Herbivores.migration_calculations">[docs]</a>    <span class="k">def</span> <span class="nf">migration_calculations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">island_class</span><span class="p">,</span> <span class="n">animals</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates which animals shall move and where they shall move to, makes one list with animals that will be</span>
<span class="sd">        placed into new positions in the migration_execution-function and one list with animals that are deleted</span>
<span class="sd">        in the migration_execution-function.</span>

<span class="sd">        :param island_class: The Island-class used to check terrain-type and amount of food in the neighbour tiles</span>
<span class="sd">        :param animals: The herbivore dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">animals_with_new_pos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idx_for_animals_to_remove</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">animals</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">rad</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">kol</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">animal</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">animals</span><span class="p">[</span><span class="n">pos</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">animal</span><span class="p">[</span><span class="s1">&#39;fitness&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu</span> <span class="o">&gt;=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">():</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">rad</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kol</span><span class="p">)</span> <span class="ow">in</span> <span class="n">animals</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">e_down</span> <span class="o">=</span> <span class="n">island_class</span><span class="o">.</span><span class="n">food</span><span class="p">[(</span><span class="n">rad</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kol</span><span class="p">)]</span> <span class="o">/</span> \
                                 <span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">animals</span><span class="p">[(</span><span class="n">rad</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kol</span><span class="p">)])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">e_down</span> <span class="o">=</span> <span class="n">island_class</span><span class="o">.</span><span class="n">food</span><span class="p">[(</span><span class="n">rad</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kol</span><span class="p">)]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span>
                    <span class="k">if</span> <span class="n">island_class</span><span class="o">.</span><span class="n">fetch_naturetype</span><span class="p">((</span><span class="n">rad</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kol</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;O&#39;</span> \
                            <span class="ow">or</span> <span class="n">island_class</span><span class="o">.</span><span class="n">fetch_naturetype</span><span class="p">((</span><span class="n">rad</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kol</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span>
                        <span class="n">p_down</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">p_down</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lambda1</span> <span class="o">*</span> <span class="n">e_down</span><span class="p">)</span>

                    <span class="k">if</span> <span class="p">(</span><span class="n">rad</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kol</span><span class="p">)</span> <span class="ow">in</span> <span class="n">animals</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">e_up</span> <span class="o">=</span> <span class="n">island_class</span><span class="o">.</span><span class="n">food</span><span class="p">[(</span><span class="n">rad</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kol</span><span class="p">)]</span> <span class="o">/</span> \
                               <span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">animals</span><span class="p">[(</span><span class="n">rad</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kol</span><span class="p">)])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">e_up</span> <span class="o">=</span> <span class="n">island_class</span><span class="o">.</span><span class="n">food</span><span class="p">[(</span><span class="n">rad</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kol</span><span class="p">)]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span>
                    <span class="k">if</span> <span class="n">island_class</span><span class="o">.</span><span class="n">fetch_naturetype</span><span class="p">((</span><span class="n">rad</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kol</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;O&#39;</span> \
                            <span class="ow">or</span> <span class="n">island_class</span><span class="o">.</span><span class="n">fetch_naturetype</span><span class="p">((</span><span class="n">rad</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kol</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span>
                        <span class="n">p_up</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">p_up</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lambda1</span> <span class="o">*</span> <span class="n">e_up</span><span class="p">)</span>

                    <span class="k">if</span> <span class="p">(</span><span class="n">rad</span><span class="p">,</span> <span class="n">kol</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">in</span> <span class="n">animals</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">e_left</span> <span class="o">=</span> <span class="n">island_class</span><span class="o">.</span><span class="n">food</span><span class="p">[(</span><span class="n">rad</span><span class="p">,</span> <span class="n">kol</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">/</span> <span class="p">(</span>
                                    <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">animals</span><span class="p">[(</span><span class="n">rad</span><span class="p">,</span> <span class="n">kol</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">e_left</span> <span class="o">=</span> <span class="n">island_class</span><span class="o">.</span><span class="n">food</span><span class="p">[(</span><span class="n">rad</span><span class="p">,</span> <span class="n">kol</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span>
                    <span class="k">if</span> <span class="n">island_class</span><span class="o">.</span><span class="n">fetch_naturetype</span><span class="p">((</span><span class="n">rad</span><span class="p">,</span> <span class="n">kol</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;O&#39;</span> \
                            <span class="ow">or</span> <span class="n">island_class</span><span class="o">.</span><span class="n">fetch_naturetype</span><span class="p">((</span><span class="n">rad</span><span class="p">,</span> <span class="n">kol</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span>
                        <span class="n">p_left</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">p_left</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lambda1</span> <span class="o">*</span> <span class="n">e_left</span><span class="p">)</span>

                    <span class="k">if</span> <span class="p">(</span><span class="n">rad</span><span class="p">,</span> <span class="n">kol</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">in</span> <span class="n">animals</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">e_right</span> <span class="o">=</span> <span class="n">island_class</span><span class="o">.</span><span class="n">food</span><span class="p">[(</span><span class="n">rad</span><span class="p">,</span> <span class="n">kol</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">/</span> <span class="p">(</span>
                                    <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">animals</span><span class="p">[(</span><span class="n">rad</span><span class="p">,</span> <span class="n">kol</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">e_right</span> <span class="o">=</span> <span class="n">island_class</span><span class="o">.</span><span class="n">food</span><span class="p">[(</span><span class="n">rad</span><span class="p">,</span> <span class="n">kol</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span>
                    <span class="k">if</span> <span class="n">island_class</span><span class="o">.</span><span class="n">fetch_naturetype</span><span class="p">((</span><span class="n">rad</span><span class="p">,</span> <span class="n">kol</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;O&#39;</span> \
                            <span class="ow">or</span> <span class="n">island_class</span><span class="o">.</span><span class="n">fetch_naturetype</span><span class="p">((</span><span class="n">rad</span><span class="p">,</span> <span class="n">kol</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span>
                        <span class="n">p_right</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">p_right</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lambda1</span> <span class="o">*</span> <span class="n">e_right</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">p_up</span> <span class="o">+</span> <span class="n">p_right</span> <span class="o">+</span> <span class="n">p_left</span> <span class="o">+</span> <span class="n">p_down</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">break</span>

                    <span class="n">prob_up</span> <span class="o">=</span> <span class="n">p_up</span> <span class="o">/</span> <span class="p">(</span><span class="n">p_down</span> <span class="o">+</span> <span class="n">p_left</span> <span class="o">+</span> <span class="n">p_right</span> <span class="o">+</span> <span class="n">p_up</span><span class="p">)</span>
                    <span class="n">prob_down</span> <span class="o">=</span> <span class="n">p_down</span> <span class="o">/</span> <span class="p">(</span><span class="n">p_down</span> <span class="o">+</span> <span class="n">p_left</span> <span class="o">+</span> <span class="n">p_right</span> <span class="o">+</span> <span class="n">p_up</span><span class="p">)</span>
                    <span class="n">prob_right</span> <span class="o">=</span> <span class="n">p_right</span> <span class="o">/</span> <span class="p">(</span><span class="n">p_down</span> <span class="o">+</span> <span class="n">p_left</span> <span class="o">+</span> <span class="n">p_right</span> <span class="o">+</span> <span class="n">p_up</span><span class="p">)</span>

                    <span class="n">direction</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>

                    <span class="k">if</span> <span class="n">direction</span> <span class="o">&lt;=</span> <span class="n">prob_right</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">animals_with_new_pos</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">rad</span><span class="p">,</span> <span class="n">kol</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;pop&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">animal</span><span class="p">]})</span>
                    <span class="k">elif</span> <span class="n">prob_right</span> <span class="o">&lt;</span> <span class="n">direction</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">prob_right</span> <span class="o">+</span> <span class="n">prob_up</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">animals_with_new_pos</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">rad</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kol</span><span class="p">),</span> <span class="s1">&#39;pop&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">animal</span><span class="p">]})</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="n">prob_right</span> <span class="o">+</span> <span class="n">prob_up</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">direction</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">prob_down</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">animals_with_new_pos</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">rad</span><span class="p">,</span> <span class="n">kol</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;pop&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">animal</span><span class="p">]})</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">animals_with_new_pos</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">rad</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kol</span><span class="p">),</span> <span class="s1">&#39;pop&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">animal</span><span class="p">]})</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">idx_for_animals_to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pos</span><span class="p">,</span> <span class="n">idx</span><span class="p">])</span></div>

<div class="viewcode-block" id="Herbivores.migration_execution"><a class="viewcode-back" href="../../animal.html#biosim.animal.Herbivores.migration_execution">[docs]</a>    <span class="k">def</span> <span class="nf">migration_execution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">island_class</span><span class="p">,</span> <span class="n">animals</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function that executes what is being calculated in the migration_calculations-functions, removes the animals</span>
<span class="sd">        that are migrating from their current positions and places them in their new position.</span>

<span class="sd">        :param island_class: The Island-class used to add animals to new positions</span>
<span class="sd">        :param animals: The herbivore dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx_for_animals_to_remove</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">del</span> <span class="n">animals</span><span class="p">[</span><span class="n">info</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">info</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">island_class</span><span class="o">.</span><span class="n">add_animals</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">animals_with_new_pos</span><span class="p">)</span></div>

<div class="viewcode-block" id="Herbivores.animals_eat"><a class="viewcode-back" href="../../animal.html#biosim.animal.Herbivores.animals_eat">[docs]</a>    <span class="k">def</span> <span class="nf">animals_eat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">island_class</span><span class="p">,</span> <span class="n">animals</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Herbivores eat, in order of their fitness.</span>

<span class="sd">        :param pos: The position/tile</span>
<span class="sd">        :param island_class: Retrives the Island-class, to make use of the food_gets_eat function</span>
<span class="sd">        :param animals: The herbivore dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">animals</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">animal</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">animals</span><span class="p">[</span><span class="n">pos</span><span class="p">]):</span>
                <span class="n">food</span> <span class="o">=</span> <span class="n">island_class</span><span class="o">.</span><span class="n">food_gets_eaten</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
                <span class="n">animals</span><span class="p">[</span><span class="n">pos</span><span class="p">][</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">*</span> <span class="n">food</span></div>

<div class="viewcode-block" id="Herbivores.tot_weight_herbivores"><a class="viewcode-back" href="../../animal.html#biosim.animal.Herbivores.tot_weight_herbivores">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">tot_weight_herbivores</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">animals</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to calculate the total weight of the herbivores, it is used in the carnivore migration_calculation-</span>
<span class="sd">        function.</span>

<span class="sd">        :param pos: The position for which we calculate the total weight</span>
<span class="sd">        :param animals: The animal dictionary, in this case the dictionary for herbivores</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">animals</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">tot_weight</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">herb</span> <span class="ow">in</span> <span class="n">animals</span><span class="p">[</span><span class="n">pos</span><span class="p">]:</span>
                <span class="n">tot_weight</span> <span class="o">+=</span> <span class="n">herb</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tot_weight</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">tot_weight</span></div></div>


<div class="viewcode-block" id="Carnivores"><a class="viewcode-back" href="../../animal.html#biosim.animal.Carnivores">[docs]</a><span class="k">class</span> <span class="nc">Carnivores</span><span class="p">(</span><span class="n">Animal</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w_birth</span><span class="o">=</span><span class="mf">6.0</span><span class="p">,</span> <span class="n">sigma_birth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">eta</span><span class="o">=</span><span class="mf">0.125</span><span class="p">,</span> <span class="n">a_half</span><span class="o">=</span><span class="mf">60.0</span><span class="p">,</span> <span class="n">phi_age</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">w_half</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span>
                 <span class="n">phi_weight</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">lambda1</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">zeta</span><span class="o">=</span><span class="mf">3.5</span><span class="p">,</span> <span class="n">xi</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span> <span class="n">omega</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="mf">50.0</span><span class="p">,</span> <span class="n">deltaphimax</span><span class="o">=</span><span class="mf">10.0</span>
                 <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The class containing all the necessary functions for herbivores</span>
<span class="sd">        :param w_birth: The average weight for a newborn Herbivore</span>
<span class="sd">        :param sigma_birth: The standard deviation for a newborn</span>
<span class="sd">        :param beta: The growing factor telling how much of the food is changed into weight</span>
<span class="sd">        :param eta: The weight reduction factor</span>
<span class="sd">        :param a_half: Fitness-factor</span>
<span class="sd">        :param phi_age: Fitness-factor</span>
<span class="sd">        :param w_half: Fitness-factor</span>
<span class="sd">        :param phi_weight: Fitness-factor</span>
<span class="sd">        :param mu: Probability for moving</span>
<span class="sd">        :param lambda1: Migration-factor</span>
<span class="sd">        :param gamma: gives the probability for giving birth, given number of animals on same tiles and their fitness</span>
<span class="sd">        :param zeta: Gives the restrictions for giving girth depending on weight</span>
<span class="sd">        :param xi: The factor for weight loss after given birth</span>
<span class="sd">        :param omega: The probability of dying given the animals fitness-value</span>
<span class="sd">        :param f: The maximum value that the carnivores eat</span>
<span class="sd">        :param deltaphimax: Constant used to calculate if the carnivore eats the herbivore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w_birth</span> <span class="o">=</span> <span class="n">w_birth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigma_birth</span> <span class="o">=</span> <span class="n">sigma_birth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="n">beta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eta</span> <span class="o">=</span> <span class="n">eta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a_half</span> <span class="o">=</span> <span class="n">a_half</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phi_age</span> <span class="o">=</span> <span class="n">phi_age</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w_half</span> <span class="o">=</span> <span class="n">w_half</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phi_weight</span> <span class="o">=</span> <span class="n">phi_weight</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mu</span> <span class="o">=</span> <span class="n">mu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lambda1</span> <span class="o">=</span> <span class="n">lambda1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zeta</span> <span class="o">=</span> <span class="n">zeta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xi</span> <span class="o">=</span> <span class="n">xi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">omega</span> <span class="o">=</span> <span class="n">omega</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">f</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deltaphimax</span> <span class="o">=</span> <span class="n">deltaphimax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">animals_with_new_pos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idx_for_animals_to_remove</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="Carnivores.set_new_params"><a class="viewcode-back" href="../../animal.html#biosim.animal.Carnivores.set_new_params">[docs]</a>    <span class="k">def</span> <span class="nf">set_new_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set class parameters.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        new_params : dict</span>
<span class="sd">            Legal keys: &#39;w_birth&#39;, &#39;sigma_birth&#39;, &#39;beta&#39;, &#39;eta&#39;, &#39;a_half&#39;, &#39;phi_age&#39;, &#39;w_half&#39;, &#39;phi_weight&#39;, &#39;mu&#39;,</span>
<span class="sd">                        &#39;lambda&#39;, &#39;gamma&#39;, &#39;zeta&#39;, &#39;xi&#39;, &#39;omega&#39;, &#39;F&#39;</span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError, KeyError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">default_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;w_birth&#39;</span><span class="p">:</span> <span class="mf">6.0</span><span class="p">,</span>
                          <span class="s1">&#39;sigma_birth&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
                          <span class="s1">&#39;beta&#39;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span>
                          <span class="s1">&#39;eta&#39;</span><span class="p">:</span> <span class="mf">0.125</span><span class="p">,</span>
                          <span class="s1">&#39;a_half&#39;</span><span class="p">:</span> <span class="mf">60.0</span><span class="p">,</span>
                          <span class="s1">&#39;phi_age&#39;</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">,</span>
                          <span class="s1">&#39;w_half&#39;</span><span class="p">:</span> <span class="mf">4.0</span><span class="p">,</span>
                          <span class="s1">&#39;phi_weight&#39;</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">,</span>
                          <span class="s1">&#39;mu&#39;</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">,</span>
                          <span class="s1">&#39;lambda&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
                          <span class="s1">&#39;gamma&#39;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span>
                          <span class="s1">&#39;zeta&#39;</span><span class="p">:</span> <span class="mf">3.5</span><span class="p">,</span>
                          <span class="s1">&#39;xi&#39;</span><span class="p">:</span> <span class="mf">1.1</span><span class="p">,</span>
                          <span class="s1">&#39;omega&#39;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span>
                          <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="mf">50.0</span><span class="p">,</span>
                          <span class="s1">&#39;DeltaPhiMax&#39;</span><span class="p">:</span> <span class="mf">10.0</span><span class="p">}</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">new_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">default_params</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;Invalid parameter name: &#39;</span> <span class="o">+</span> <span class="n">key</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;w_birth&#39;</span> <span class="ow">in</span> <span class="n">new_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;w_birth&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;birth_weight must be larger or equal to 0&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">w_birth</span> <span class="o">=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;w_birth&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;sigma_birth&#39;</span> <span class="ow">in</span> <span class="n">new_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;sigma_birth&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;sigma_birth must be larger or equal to 0&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigma_birth</span> <span class="o">=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;sigma_birth&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;beta&#39;</span> <span class="ow">in</span> <span class="n">new_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;p_death must be larger or equal to 0.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;eta&#39;</span> <span class="ow">in</span> <span class="n">new_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;eta&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;p_divide must be in [0, 1].&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eta</span> <span class="o">=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;eta&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;a_half&#39;</span> <span class="ow">in</span> <span class="n">new_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;a_half&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;a_half must be larger or equal to 0.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a_half</span> <span class="o">=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;a_half&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;phi_age&#39;</span> <span class="ow">in</span> <span class="n">new_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;phi_age&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;phi_age must be larger or equal to 0.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phi_age</span> <span class="o">=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;phi_age&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;w_half&#39;</span> <span class="ow">in</span> <span class="n">new_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;w_half&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;w_half must be larger or equal to 0&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">w_half</span> <span class="o">=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;w_half&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;phi_weight&#39;</span> <span class="ow">in</span> <span class="n">new_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;phi_weight&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;phi_weight must be larger or equal to 0.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phi_weight</span> <span class="o">=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;phi_weight&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;mu&#39;</span> <span class="ow">in</span> <span class="n">new_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;mu&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;mu must be larger or equal to 0.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mu</span> <span class="o">=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;mu&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;lambda&#39;</span> <span class="ow">in</span> <span class="n">new_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;lambda&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;lambda must be larger or equal to 0.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lambda1</span> <span class="o">=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;lambda&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;gamma&#39;</span> <span class="ow">in</span> <span class="n">new_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;gamma&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;gamma must be larger or equal to 0.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;gamma&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;zeta&#39;</span> <span class="ow">in</span> <span class="n">new_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;zeta&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;zeta must be larger or equal to 0&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zeta</span> <span class="o">=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;zeta&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;xi&#39;</span> <span class="ow">in</span> <span class="n">new_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;xi&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;xi must be larger or equal to 0&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xi</span> <span class="o">=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;xi&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;omega&#39;</span> <span class="ow">in</span> <span class="n">new_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;omega&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;omega must be larger or equal to 0.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">omega</span> <span class="o">=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;omega&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;F&#39;</span> <span class="ow">in</span> <span class="n">new_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;F must be larger or equal to 0&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;DeltaPhiMax&#39;</span> <span class="ow">in</span> <span class="n">new_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;DeltaPhiMax&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;DeltaPhiMax must be larger than 0&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">deltaphimax</span> <span class="o">=</span> <span class="n">new_params</span><span class="p">[</span><span class="s1">&#39;DeltaPhiMax&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="Carnivores.carnivores_eat"><a class="viewcode-back" href="../../animal.html#biosim.animal.Carnivores.carnivores_eat">[docs]</a>    <span class="k">def</span> <span class="nf">carnivores_eat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">island_class</span><span class="p">,</span> <span class="n">animals</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for the carnivores to eat.</span>

<span class="sd">        :param pos: Position for which the animals shall eat</span>
<span class="sd">        :param island_class: The Island-class, used to import the herbivores</span>
<span class="sd">        :param animals: The carnivore dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">animals</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">idx1</span><span class="p">,</span> <span class="n">carnivore</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">animals</span><span class="p">[</span><span class="n">pos</span><span class="p">]):</span>
                <span class="n">prey_weight</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">island_class</span><span class="o">.</span><span class="n">herbs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">idx2</span><span class="p">,</span> <span class="n">herbivore</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">island_class</span><span class="o">.</span><span class="n">herbs</span><span class="p">[</span><span class="n">pos</span><span class="p">]):</span>
                        <span class="k">if</span> <span class="n">carnivore</span><span class="p">[</span><span class="s1">&#39;fitness&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">herbivore</span><span class="p">[</span><span class="s1">&#39;fitness&#39;</span><span class="p">]:</span>
                            <span class="n">p</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">elif</span> <span class="n">carnivore</span><span class="p">[</span><span class="s1">&#39;fitness&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">herbivore</span><span class="p">[</span><span class="s1">&#39;fitness&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltaphimax</span><span class="p">:</span>
                            <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">carnivore</span><span class="p">[</span><span class="s1">&#39;fitness&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">herbivore</span><span class="p">[</span><span class="s1">&#39;fitness&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltaphimax</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">p</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">():</span>
                            <span class="n">prey_weight</span> <span class="o">+=</span> <span class="n">herbivore</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span>
                            <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx2</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">prey_weight</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">:</span>
                            <span class="n">animals</span><span class="p">[</span><span class="n">pos</span><span class="p">][</span><span class="n">idx1</span><span class="p">][</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span>
                            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                                <span class="k">del</span> <span class="n">island_class</span><span class="o">.</span><span class="n">herbs</span><span class="p">[</span><span class="n">pos</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span>
                            <span class="k">break</span>
                        <span class="k">elif</span> <span class="n">prey_weight</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;</span> <span class="n">idx2</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">island_class</span><span class="o">.</span><span class="n">herbs</span><span class="p">[</span><span class="n">pos</span><span class="p">]):</span>
                            <span class="n">animals</span><span class="p">[</span><span class="n">pos</span><span class="p">][</span><span class="n">idx1</span><span class="p">][</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">*</span> <span class="n">prey_weight</span>
                            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                                <span class="k">del</span> <span class="n">island_class</span><span class="o">.</span><span class="n">herbs</span><span class="p">[</span><span class="n">pos</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span>
                            <span class="k">break</span></div>

<div class="viewcode-block" id="Carnivores.migration_calculations"><a class="viewcode-back" href="../../animal.html#biosim.animal.Carnivores.migration_calculations">[docs]</a>    <span class="k">def</span> <span class="nf">migration_calculations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">island_class</span><span class="p">,</span> <span class="n">herb_class</span><span class="p">,</span> <span class="n">animals</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates which animals shall move and where they shall move to, makes one list with animals that will be</span>
<span class="sd">        placed into new positions in the migration_execution-function and one list with animals that are deleted</span>
<span class="sd">        in the migration_execution-function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param island_class: The Island-class used to check terrain-type and total weight of the herbivores</span>
<span class="sd">                             in the neighbour tiles</span>
<span class="sd">        :param herb_class: The Herbivore-class imported to use calculate total weight of the herbivores</span>
<span class="sd">        :param animals: The carnivore dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">animals_with_new_pos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idx_for_animals_to_remove</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">animals</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">rad</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">kol</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">animal</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">animals</span><span class="p">[</span><span class="n">pos</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">animal</span><span class="p">[</span><span class="s1">&#39;fitness&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu</span> <span class="o">&gt;=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">():</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">rad</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kol</span><span class="p">)</span> <span class="ow">in</span> <span class="n">animals</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">e_down</span> <span class="o">=</span> <span class="n">herb_class</span><span class="o">.</span><span class="n">tot_weight_herbivores</span><span class="p">((</span><span class="n">rad</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kol</span><span class="p">),</span> <span class="n">island_class</span><span class="o">.</span><span class="n">herbs</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                                <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">animals</span><span class="p">[(</span><span class="n">rad</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kol</span><span class="p">)])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">e_down</span> <span class="o">=</span> <span class="n">herb_class</span><span class="o">.</span><span class="n">tot_weight_herbivores</span><span class="p">((</span><span class="n">rad</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kol</span><span class="p">),</span> <span class="n">island_class</span><span class="o">.</span><span class="n">herbs</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span>
                    <span class="k">if</span> <span class="n">island_class</span><span class="o">.</span><span class="n">fetch_naturetype</span><span class="p">((</span><span class="n">rad</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kol</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;O&#39;</span> <span class="ow">or</span> \
                            <span class="n">island_class</span><span class="o">.</span><span class="n">fetch_naturetype</span><span class="p">((</span><span class="n">rad</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kol</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span>
                        <span class="n">p_down</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">p_down</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lambda1</span> <span class="o">*</span> <span class="n">e_down</span><span class="p">)</span>

                    <span class="k">if</span> <span class="p">(</span><span class="n">rad</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kol</span><span class="p">)</span> <span class="ow">in</span> <span class="n">animals</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">e_up</span> <span class="o">=</span> <span class="n">herb_class</span><span class="o">.</span><span class="n">tot_weight_herbivores</span><span class="p">((</span><span class="n">rad</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kol</span><span class="p">),</span> <span class="n">island_class</span><span class="o">.</span><span class="n">herbs</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                                <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">animals</span><span class="p">[(</span><span class="n">rad</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kol</span><span class="p">)])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">e_up</span> <span class="o">=</span> <span class="n">herb_class</span><span class="o">.</span><span class="n">tot_weight_herbivores</span><span class="p">((</span><span class="n">rad</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kol</span><span class="p">),</span> <span class="n">island_class</span><span class="o">.</span><span class="n">herbs</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span>
                    <span class="k">if</span> <span class="n">island_class</span><span class="o">.</span><span class="n">fetch_naturetype</span><span class="p">((</span><span class="n">rad</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kol</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;O&#39;</span> <span class="ow">or</span> \
                            <span class="n">island_class</span><span class="o">.</span><span class="n">fetch_naturetype</span><span class="p">((</span><span class="n">rad</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kol</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span>
                        <span class="n">p_up</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">p_up</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lambda1</span> <span class="o">*</span> <span class="n">e_up</span><span class="p">)</span>

                    <span class="k">if</span> <span class="p">(</span><span class="n">rad</span><span class="p">,</span> <span class="n">kol</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">in</span> <span class="n">animals</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">e_left</span> <span class="o">=</span> <span class="n">herb_class</span><span class="o">.</span><span class="n">tot_weight_herbivores</span><span class="p">((</span><span class="n">rad</span><span class="p">,</span> <span class="n">kol</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">island_class</span><span class="o">.</span><span class="n">herbs</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                                    <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">animals</span><span class="p">[(</span><span class="n">rad</span><span class="p">,</span> <span class="n">kol</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">e_left</span> <span class="o">=</span> <span class="n">herb_class</span><span class="o">.</span><span class="n">tot_weight_herbivores</span><span class="p">((</span><span class="n">rad</span><span class="p">,</span> <span class="n">kol</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">island_class</span><span class="o">.</span><span class="n">herbs</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span>
                    <span class="k">if</span> <span class="n">island_class</span><span class="o">.</span><span class="n">fetch_naturetype</span><span class="p">((</span><span class="n">rad</span><span class="p">,</span> <span class="n">kol</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;O&#39;</span> <span class="ow">or</span> \
                            <span class="n">island_class</span><span class="o">.</span><span class="n">fetch_naturetype</span><span class="p">((</span><span class="n">rad</span><span class="p">,</span> <span class="n">kol</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span>
                        <span class="n">p_left</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">p_left</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lambda1</span> <span class="o">*</span> <span class="n">e_left</span><span class="p">)</span>

                    <span class="k">if</span> <span class="p">(</span><span class="n">rad</span><span class="p">,</span> <span class="n">kol</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">in</span> <span class="n">animals</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">e_right</span> <span class="o">=</span> <span class="n">herb_class</span><span class="o">.</span><span class="n">tot_weight_herbivores</span><span class="p">((</span><span class="n">rad</span><span class="p">,</span> <span class="n">kol</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">island_class</span><span class="o">.</span><span class="n">herbs</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                                    <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">animals</span><span class="p">[(</span><span class="n">rad</span><span class="p">,</span> <span class="n">kol</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">e_right</span> <span class="o">=</span> <span class="n">herb_class</span><span class="o">.</span><span class="n">tot_weight_herbivores</span><span class="p">((</span><span class="n">rad</span><span class="p">,</span> <span class="n">kol</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">island_class</span><span class="o">.</span><span class="n">herbs</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span>
                    <span class="k">if</span> <span class="n">island_class</span><span class="o">.</span><span class="n">fetch_naturetype</span><span class="p">((</span><span class="n">rad</span><span class="p">,</span> <span class="n">kol</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;O&#39;</span> <span class="ow">or</span> \
                            <span class="n">island_class</span><span class="o">.</span><span class="n">fetch_naturetype</span><span class="p">((</span><span class="n">rad</span><span class="p">,</span> <span class="n">kol</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span>
                        <span class="n">p_right</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">p_right</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lambda1</span> <span class="o">*</span> <span class="n">e_right</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">p_up</span> <span class="o">+</span> <span class="n">p_right</span> <span class="o">+</span> <span class="n">p_left</span> <span class="o">+</span> <span class="n">p_down</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">break</span>

                    <span class="n">prob_up</span> <span class="o">=</span> <span class="n">p_up</span> <span class="o">/</span> <span class="p">(</span><span class="n">p_down</span> <span class="o">+</span> <span class="n">p_left</span> <span class="o">+</span> <span class="n">p_right</span> <span class="o">+</span> <span class="n">p_up</span><span class="p">)</span>
                    <span class="n">prob_down</span> <span class="o">=</span> <span class="n">p_down</span> <span class="o">/</span> <span class="p">(</span><span class="n">p_down</span> <span class="o">+</span> <span class="n">p_left</span> <span class="o">+</span> <span class="n">p_right</span> <span class="o">+</span> <span class="n">p_up</span><span class="p">)</span>
                    <span class="n">prob_right</span> <span class="o">=</span> <span class="n">p_right</span> <span class="o">/</span> <span class="p">(</span><span class="n">p_down</span> <span class="o">+</span> <span class="n">p_left</span> <span class="o">+</span> <span class="n">p_right</span> <span class="o">+</span> <span class="n">p_up</span><span class="p">)</span>

                    <span class="n">direction</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>

                    <span class="k">if</span> <span class="n">direction</span> <span class="o">&lt;=</span> <span class="n">prob_right</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">animals_with_new_pos</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">rad</span><span class="p">,</span> <span class="n">kol</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;pop&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">animal</span><span class="p">]})</span>
                    <span class="k">elif</span> <span class="n">prob_right</span> <span class="o">&lt;</span> <span class="n">direction</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">prob_right</span> <span class="o">+</span> <span class="n">prob_up</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">animals_with_new_pos</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">rad</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kol</span><span class="p">),</span> <span class="s1">&#39;pop&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">animal</span><span class="p">]})</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="n">prob_right</span> <span class="o">+</span> <span class="n">prob_up</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">direction</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">prob_down</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">animals_with_new_pos</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">rad</span><span class="p">,</span> <span class="n">kol</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;pop&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">animal</span><span class="p">]})</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">animals_with_new_pos</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">rad</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kol</span><span class="p">),</span> <span class="s1">&#39;pop&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">animal</span><span class="p">]})</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">idx_for_animals_to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pos</span><span class="p">,</span> <span class="n">idx</span><span class="p">])</span></div>

<div class="viewcode-block" id="Carnivores.migration_execution"><a class="viewcode-back" href="../../animal.html#biosim.animal.Carnivores.migration_execution">[docs]</a>    <span class="k">def</span> <span class="nf">migration_execution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">island_class</span><span class="p">,</span> <span class="n">animals</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function that executes what is being calculated in the migration_calculations-functions, removes the animals</span>
<span class="sd">        that are migrating from their current positions and places them in their new position.</span>

<span class="sd">        :param island_class: The Island-class used to add animals to new positions</span>
<span class="sd">        :param animals: The carnivore dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx_for_animals_to_remove</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">del</span> <span class="n">animals</span><span class="p">[</span><span class="n">info</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">info</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">island_class</span><span class="o">.</span><span class="n">add_animals</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">animals_with_new_pos</span><span class="p">)</span></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">BioSim_G25_Granheim_Svebestad</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api_references.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_references.html#class-biosim">Class biosim</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../island.html">Module island</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../animal.html">Module animal</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Markus Ola Holte Granheim & Rasmus Svebestad.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.9</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.11</a>
      
    </div>

    

    
  </body>
</html>